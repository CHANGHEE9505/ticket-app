pipeline {
    agent any

    stages {
        // 1. ê¹ƒí—ˆë¸Œì—ì„œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        // 2. í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œ í‘¸ì‹œ
        stage('Build & Push Frontend') {
            steps {
                // ì¤‘ìš”: frontend í´ë” ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ì„œ ì‘ì—…í•´ë¼!
                dir('frontend') {
                    script {
                        echo 'Building Frontend Image...'
                        
                        // ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ (ì´ë¯¸ì§€ ì´ë¦„: ticket-frontend)
                        sh 'docker build -t changhee9505/ticket-frontend:latest .'
                        
                        // ë„ì»¤ í—ˆë¸Œ ë¡œê·¸ì¸ ë° í‘¸ì‹œ
                        // (credentialsIdëŠ” ì  í‚¨ìŠ¤ì— ë“±ë¡í•œ IDì™€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤. ë³´í†µ docker-hub-login ì‚¬ìš©)
                        withCredentials([usernamePassword(credentialsId: 'docker-hub-login', usernameVariable: 'USER', passwordVariable: 'PASS')]) {
                            sh 'docker build -t clouddxuser/ticket-frontend:latest .'
                            sh 'docker push clouddxuser/ticket-frontend:latest'
                        }
                    }
                }
            }
        }
    }
    
    // (ì„ íƒ ì‚¬í•­) ë¹Œë“œ ëë‚˜ë©´ ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥
    post {
        success {
            echo 'Frontend Build & Push Success! ğŸ‰'
        }
        failure {
            echo 'Frontend Build Failed... ğŸ˜¢'
        }
    }
}